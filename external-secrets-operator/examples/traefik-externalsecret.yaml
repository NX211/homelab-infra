---
# Example: ExternalSecret for Traefik
# This pulls the dreamhost-api-key from Bitwarden (via sync) and creates traefik-secrets
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: traefik-secrets
  namespace: default
spec:
  # Refresh every hour
  refreshInterval: 1h

  # Use the Kubernetes backend ClusterSecretStore
  secretStoreRef:
    name: kubernetes-backend
    kind: ClusterSecretStore

  # Target secret name in this namespace
  target:
    name: traefik-secrets
    creationPolicy: Owner

  # Map Bitwarden secrets to Kubernetes secret keys
  data:
    # The secret in Bitwarden is named "DREAMHOST_TOKEN"
    # It gets synced to secrets-vault namespace as a k8s secret named "dreamhost-token"
    # We pull the "value" key from that secret
    - secretKey: dreamhost-api-key
      remoteRef:
        key: dreamhost-token
        property: value

    # Also create the dreamhost-token key
    - secretKey: dreamhost-token
      remoteRef:
        key: dreamhost-token
        property: value
