# Traefik Helm Chart Values for k3s Homelab
# Minimal working configuration

traefik:
  # Global arguments
  globalArguments:
    - "--global.checknewversion=false"
    - "--global.sendanonymoususage=false"

  # Deployment (using Deployment for ACME support)
  deployment:
    kind: Deployment
    replicas: 1

  # Node selector - only yellowtalon has proxy role
  nodeSelector:
    node-role.kubernetes.io/proxy: "true"

  # Service
  service:
    type: ClusterIP

  # Ports
  ports:
    web:
      port: 80
      redirectTo:
        port: websecure
    websecure:
      port: 443
      tls:
        enabled: true

  # Environment for Dreamhost DNS
  env:
    - name: DREAMHOST_TOKEN
      valueFrom:
        secretKeyRef:
          name: traefik-secrets
          key: dreamhost-token

  # Let's Encrypt ACME
  additionalArguments:
    - "--certificatesresolvers.dnschallenge.acme.email=contact@authoritah.com"
    - "--certificatesresolvers.dnschallenge.acme.storage=/data/acme.json"
    - "--certificatesresolvers.dnschallenge.acme.dnschallenge=true"
    - "--certificatesresolvers.dnschallenge.acme.dnschallenge.provider=dreamhost"

  # Logs
  logs:
    general:
      level: INFO
    access:
      enabled: true

  # Providers
  providers:
    kubernetesCRD:
      enabled: true
      allowCrossNamespace: true
    kubernetesIngress:
      enabled: true

  # Persistence for ACME
  persistence:
    enabled: true
    size: 1Gi
    storageClass: "local-path"

  # Resources
  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 500m
      memory: 512Mi
